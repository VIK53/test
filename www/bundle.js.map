{"version":3,"sources":["src/js/func.js","bundle.js","src/js/upload.js","src/js/main.js"],"names":["ajax_get","url","callback","xhr","XMLHttpRequest","onreadystatechange","readyState","status","data","JSON","parse","responseText","err","console","info","error","open","send","window","URL","webkitURL","FUItmBox","document","querySelector","MAX_FSIZE","MAX_FILES","onChangeInput","inpName","this","getAttribute","id","v","encodeURIComponent","value","that","r","classList","add","remove","upload","files","fNum","length","alert","i","size","log","name","onload","onerror","xhrOnload","formData","FormData","append","val","fn","filesItem","createElement","innerHTML","onchange","prepend","t","querySelectorAll","p","addEventListener","act","event","target","fileItemBox","parentElement","inputEl","user_doc_box"],"mappings":"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","file":"bundle.js","sourcesContent":["//Функции пишем здесь\n\nexport function ajax_get(url, callback) {\n\txhr = new XMLHttpRequest();\n\txhr.onreadystatechange = function() {\n\t\tif (xhr.readyState == 4 && xhr.status == 200) {\n\t\t\ttry {\n\t\t\t\tvar data = JSON.parse(xhr.responseText);\n\t\t\t} catch(err) {\n\t\t\t\tconsole.info('url:', url);\n\t\t\t\tconsole.error('response: ', xhr.responseText);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tcallback(data);\n\t\t}\n\t}\n\txhr.open(\"GET\", url, true);\n\txhr.send();\n}\n",null,"import {ajax_get} from './func';\n\n/*Загрузка файлов*/\nwindow.URL = window.URL || window.webkitURL;\nvar FUItmBox = document.querySelector('.FUItmBox');\nvar MAX_FSIZE = 2*1024*1024,//2 МБайта\nMAX_FILES = 5;\n\nexport function onChangeInput(){\n\tvar inpName = this.getAttribute('name');\n\tvar id = this.getAttribute('data-id');\n\tvar v = encodeURIComponent(this.value);\n\tvar that = this;\n\tajax_get('field_save.php?n='+inpName+'&id='+id+'&v='+ v, function(r){\n\t\tif(r.err) that.classList.add(\"alert\"); //alert(r.err);\n\t\telse that.classList.remove(\"alert\");\n\t})\n}\n\nexport function upload(){\n\tvar target = e.target;\n\tvar files = this.files;\n\t//var input_name = this.getAttribute('name');//\n\t//var id = this.getAttribute('data-id');\n\tvar fNum = files.length;\n\tif(!fNum) {\n   \talert(\"Файлы не выбраны.\");\n\t\treturn false;\n\t}else if(fNum >MAX_FILES){\n   \talert(\"Можно загружать не более \"+MAX_FILES+\" фото\");\n\t\treturn false;\n\t}\n\n  for(var i = 0; i < fNum; i++){\n\t\tif(files[i].size > MAX_FSIZE){\n\t\t\tconsole.log('Превышение размера ' + files[i].name + ' лиммт: ' + MAX_FSIZE/1048576 + 'МБ');\n\t\t\tcontinue;\n\t\t}\n\t\tvar xhr = new XMLHttpRequest();\n\t\txhr.onload = xhr.onerror = xhrOnload;\n\n\t\tvar formData = new FormData();\n\t\tformData.append('files[]', files[i]);\n\t\txhr.open(\"post\", 'file_save.php');\n\t \txhr.send(formData);\n\t}\n\treturn false;\n}\n\nfunction xhrOnload(){\n\tif (this.status == 200) {\n\t\t//console.log('this.responseText=',this.responseText);\n\t\tvar val = JSON.parse(this.responseText);\n\t\tif(!val.err) console.log('Загружено: ' + val['orig_name']);\n\t\telse{\n\t\t\tconsole.log(val.err);\n\t\t\treturn;\n\t\t}\n\t\tvar fn = val['name'];\n\t\t//Создаём элемента списка файлов\n\t\tvar filesItem = document.createElement('div');\n\t\tfilesItem.innerHTML = '<input data-id=\"' + val['id'] + '\" data-fn=\"'+ fn +'\" type=\"text\" name=\"fileNote\" value=\"' + val['orig_name'] + '\">';\n\t\tfilesItem.querySelector('input').onchange=onChangeInput;\n\t\tdocument.querySelector('.VIK_user_doc').prepend(filesItem);\n\t} else {\n\t\tconsole.log(\"error \" + this.status);\n\t}\n}","import {upload,onChangeInput} from './upload';\nimport {ajax_get} from './func';\n\nvar t=document.querySelectorAll('.VIK input[type=\"text\"]');\nfor(var i=0; i< t.length;i++){\n\tt[i].onchange=onChangeInput;\n}\n\nvar p = document.createElement('p');\np.innerHTML = '<span data-act=view>открыть</span> | <span data-act=del>удалить</span>';\np.addEventListener(\"click\", function(){ \n\tvar act = event.target.getAttribute('data-act');\n\tvar fileItemBox = event.target.parentElement.parentElement;\n\tvar inputEl=fileItemBox.querySelector('input');\n\tvar id = inputEl.getAttribute('data-id');\n\tvar fn = inputEl.getAttribute('data-fn');\n\tvar name = inputEl.getAttribute('data-name');\n\tvar val = inputEl.value;\n\tif(act === 'view') window.open('./upload/' + fn, '_blank');\n\telse if(act === 'del'){\n\t\tajax_get('del_file.php?id='+id, function(r){\n\t\t\t//console.log('r=',r);\n\t\t\tif(!r.err) fileItemBox.remove();\n\t\t})\n\t}\n});\n\n//Загрузка файлов\nvar t=document.querySelector('.VIK input[type=\"file\"]');\nt.addEventListener(\"change\", upload);\n\n//Панель кнопок \"посмотреть | удалить\"\nvar user_doc_box=document.querySelector('.VIK_user_doc');\nuser_doc_box.addEventListener(\"focusin\", function(){ \n\tvar t = event.target;\n\t//console.log(t);\n\tvar user_doc = t.parentElement;\n\tuser_doc.append(p);\n});\n"]}